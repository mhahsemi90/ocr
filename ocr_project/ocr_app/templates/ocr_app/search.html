<!-- templates/ocr_app/search.html -->
{% extends 'ocr_app/base.html' %}
{% load permission_tags %}

{% block page_title %}ุฌุณุชุฌู ูพุดุฑูุชู{% endblock %}

{% block content %}
<div class="header">
    <h1>ุฌุณุชุฌู ูพุดุฑูุชู</h1>
    <p style="color: #7f8c8d; margin-top: 10px;">ุฌุณุชุฌู ุฏุฑ ุจู ุงูุฑุงุฏ ู ุงุณูุงุฏ ุจุง ููุชุฑูุง ูุฎุชูู</p>
</div>

<div class="search-tabs" style="margin-bottom: 20px;">
    <div style="display: flex; border-bottom: 2px solid #e0e0e0;">
        <button id="personTab" class="tab-button active" onclick="showTab('person')"
                style="padding: 12px 25px; border: none; background: none; font-size: 16px; cursor: pointer; border-bottom: 3px solid #3498db; color: #3498db;">
            ๐ฅ ุฌุณุชุฌู ุงูุฑุงุฏ
        </button>
        <button id="documentTab" class="tab-button" onclick="showTab('document')"
                style="padding: 12px 25px; border: none; background: none; font-size: 16px; cursor: pointer; color: #7f8c8d;">
            ๐ ุฌุณุชุฌู ุงุณูุงุฏ
        </button>
    </div>
</div>

<!-- ูุฑู ุฌุณุชุฌู ุงูุฑุงุฏ -->
<div id="personSearch" class="search-form">
    <div style="background: white; padding: 25px; border-radius: 10px; margin-bottom: 20px;">
        <h4 style="color: #2c3e50; margin-bottom: 20px;">ุฌุณุชุฌู ุฏุฑ ุงุทูุงุนุงุช ุงูุฑุงุฏ</h4>

        <form id="personSearchForm" method="GET" action="{% url 'search_documents' %}">
            <input type="hidden" name="search_type" value="persons">

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label style="display: block; margin-bottom: 8px; color: #555; font-weight: bold;">ูุงู:</label>
                    <input type="text" name="first_name" placeholder="ูุงู"
                           style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                </div>

                <div>
                    <label style="display: block; margin-bottom: 8px; color: #555; font-weight: bold;">ูุงู ุฎุงููุงุฏฺฏ:</label>
                    <input type="text" name="last_name" placeholder="ูุงู ุฎุงููุงุฏฺฏ"
                           style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                <div>
                    <label style="display: block; margin-bottom: 8px; color: #555; font-weight: bold;">ฺฉุฏ ูู:</label>
                    <input type="text" name="national_id" placeholder="ฺฉุฏ ูู"
                           style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                </div>

                <div>
                    <label style="display: block; margin-bottom: 8px; color: #555; font-weight: bold;">ุดูุงุฑู ูพุฑุณูู:</label>
                    <input type="text" name="employee_id" placeholder="ุดูุงุฑู ูพุฑุณูู"
                           style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                </div>
            </div>

            <div style="text-align: center;">
                {% if user.is_authenticated and user|has_perm:'search_persons' %}
                <button type="submit" class="btn btn-primary" style="padding: 12px 40px;">
                    ๐ ุฌุณุชุฌู ุงูุฑุงุฏ
                </button>
                {% else %}
                <button type="button" class="btn btn-primary" disabled style="padding: 12px 40px; background: #95a5a6; cursor: not-allowed;">
                    ๐ ุฌุณุชุฌู ุงูุฑุงุฏ
                </button>
                {% endif %}
                <button type="button" class="btn" onclick="clearPersonForm()"
                        style="background: #95a5a6; color: white; padding: 12px 40px; margin-right: 10px;">
                    ๐๏ธ ูพุงฺฉ ฺฉุฑุฏู
                </button>
            </div>
        </form>
    </div>
</div>

<!-- ูุฑู ุฌุณุชุฌู ุงุณูุงุฏ -->
<div id="documentSearch" class="search-form" style="display: none;">
    <div style="background: white; padding: 25px; border-radius: 10px; margin-bottom: 20px;">
        <h4 style="color: #2c3e50; margin-bottom: 20px;">ุฌุณุชุฌู ุฏุฑ ูุญุชูุง ุงุณูุงุฏ</h4>

        <form id="documentSearchForm" method="GET" action="{% url 'search_documents' %}">
            <input type="hidden" name="search_type" value="documents">

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; color: #555; font-weight: bold;">ูุชู ุฏุฑ ุงุณูุงุฏ:</label>
                <input type="text" name="document_text" placeholder="ูุชู ููุฑุฏ ุฌุณุชุฌู ุฏุฑ ุงุณูุงุฏ"
                       style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                <small style="color: #7f8c8d; display: block; margin-top: 5px;">
                    ุฌุณุชุฌู ุฏุฑ ูุชู ุงุณุชุฎุฑุงุฌ ุดุฏูุ ูุงู ูุงู ู ุดุฑุญ ุณูุฏ ุงูุฌุงู ูโุดูุฏ
                </small>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                <div>
                    <label style="display: block; margin-bottom: 8px; color: #555; font-weight: bold;">ูุถุนุช ูพุฑุฏุงุฒุด:</label>
                    <select name="processing_status" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <option value="">ููู ูุถุนุชโูุง</option>
                        <option value="processed">ูพุฑุฏุงุฒุด ุดุฏู</option>
                        <option value="pending">ุฏุฑ ุงูุชุธุงุฑ ูพุฑุฏุงุฒุด</option>
                    </select>
                </div>

                <div>
                    <label style="display: block; margin-bottom: 8px; color: #555; font-weight: bold;">ููุน ูุงู:</label>
                    <select name="file_type" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <option value="">ููู ููุนโูุง</option>
                        <option value="pdf">PDF</option>
                        <option value="jpg">JPG</option>
                        <option value="png">PNG</option>
                        <option value="jpeg">JPEG</option>
                    </select>
                </div>
            </div>

            <div style="text-align: center;">
                {% if user.is_authenticated and user|has_perm:'search_documents' %}
                <button type="submit" class="btn btn-success" style="padding: 12px 40px;">
                    ๐ ุฌุณุชุฌู ุงุณูุงุฏ
                </button>
                {% else %}
                <button type="button" class="btn btn-success" disabled style="padding: 12px 40px; background: #95a5a6; cursor: not-allowed;">
                    ๐ ุฌุณุชุฌู ุงุณูุงุฏ
                </button>
                {% endif %}
                <button type="button" class="btn" onclick="clearDocumentForm()"
                        style="background: #95a5a6; color: white; padding: 12px 40px; margin-right: 10px;">
                    ๐๏ธ ูพุงฺฉ ฺฉุฑุฏู
                </button>
            </div>
        </form>
    </div>
</div>

<!-- ุฑุงูููุง ุฌุณุชุฌู -->
<div class="help-section" style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-right: 4px solid #3498db;">
    <h4 style="color: #2c3e50; margin-bottom: 15px;">๐ก ุฑุงูููุง ุฌุณุชุฌู</h4>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div id="personHelp">
            <h5 style="color: #3498db; margin-bottom: 10px;">๐ฅ ุฌุณุชุฌู ุงูุฑุงุฏ</h5>
            <ul style="color: #7f8c8d; margin: 0; padding-right: 15px; line-height: 1.6;">
                <li>ุฌุณุชุฌู ุจุฑ ุงุณุงุณ ูุงูุ ูุงู ุฎุงููุงุฏฺฏุ ฺฉุฏ ูู ู ุดูุงุฑู ูพุฑุณูู</li>
                <li>ูุชุงุฌ ุจู ุตูุฑุช ูุณุช ุงูุฑุงุฏ ููุงุด ุฏุงุฏู ูโุดูุฏ</li>
                <li>ุจุง ฺฉูฺฉ ุฑู ูุฑ ูุฑุฏ ูโุชูุงูุฏ ูพุฑููุฏู ุขู ุฑุง ูุดุงูุฏู ฺฉูุฏ</li>
            </ul>
        </div>
        <div id="documentHelp" style="display: none;">
            <h5 style="color: #27ae60; margin-bottom: 10px;">๐ ุฌุณุชุฌู ุงุณูุงุฏ</h5>
            <ul style="color: #7f8c8d; margin: 0; padding-right: 15px; line-height: 1.6;">
                <li>ุฌุณุชุฌู ุฏุฑ ูุชู ุงุณุชุฎุฑุงุฌ ุดุฏูุ ูุงู ูุงู ู ุดุฑุญ ุณูุฏ</li>
                <li>ููุชุฑ ุจุฑ ุงุณุงุณ ูุถุนุช ูพุฑุฏุงุฒุด ู ููุน ูุงู</li>
                <li>ูุชุงุฌ ุจู ุตูุฑุช ูุณุช ุงุณูุงุฏ ููุงุด ุฏุงุฏู ูโุดูุฏ</li>
            </ul>
        </div>
    </div>
</div>

<script>
    function showTab(tabName) {
        // ูุฎู ฺฉุฑุฏู ููู ุชุจโูุง
        document.getElementById('personSearch').style.display = 'none';
        document.getElementById('documentSearch').style.display = 'none';
        document.getElementById('personHelp').style.display = 'none';
        document.getElementById('documentHelp').style.display = 'none';

        // ุบุฑูุนุงู ฺฉุฑุฏู ููู ุฏฺฉููโูุง
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.style.borderBottom = 'none';
            btn.style.color = '#7f8c8d';
        });

        // ููุงุด ุชุจ ุงูุชุฎุงุจ ุดุฏู
        if (tabName === 'person') {
            document.getElementById('personSearch').style.display = 'block';
            document.getElementById('personHelp').style.display = 'block';
            document.getElementById('personTab').style.borderBottom = '3px solid #3498db';
            document.getElementById('personTab').style.color = '#3498db';
        } else {
            document.getElementById('documentSearch').style.display = 'block';
            document.getElementById('documentHelp').style.display = 'block';
            document.getElementById('documentTab').style.borderBottom = '3px solid #27ae60';
            document.getElementById('documentTab').style.color = '#27ae60';
        }
    }

    function clearPersonForm() {
        document.getElementById('personSearchForm').reset();
    }

    function clearDocumentForm() {
        document.getElementById('documentSearchForm').reset();
    }

    // ุชูุธู ุงููู ุจุฑ ุงุณุงุณ ูพุงุฑุงูุชุฑูุง URL
    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const searchType = urlParams.get('search_type');

        if (searchType === 'documents') {
            showTab('document');
        } else {
            showTab('person');
        }

        // ูพุฑ ฺฉุฑุฏู ูุฑูโูุง ุจุง ููุงุฏุฑ ูุจู
        ['first_name', 'last_name', 'national_id', 'employee_id', 'document_text', 'processing_status', 'file_type'].forEach(param => {
            const value = urlParams.get(param);
            if (value) {
                const input = document.querySelector(`[name="${param}"]`);
                if (input) input.value = value;
            }
        });
    });
</script>

<style>
    .tab-button {
        transition: all 0.3s ease;
    }

    .tab-button:hover {
        background: #f8f9fa !important;
    }

    input:focus, select:focus {
        outline: none;
        border-color: #3498db !important;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }
</style>
{% endblock %}