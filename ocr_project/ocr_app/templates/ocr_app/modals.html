<!-- templates/ocr_app/modals.html -->
<!-- Modal Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡ -->
<div id="createFolderModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000;">
    <div style="background: white; width: 500px; margin: 100px auto; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3);">
        <h3 style="color: #2c3e50; margin-bottom: 20px;">Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡ Ø¬Ø¯ÛŒØ¯</h3>
        <form id="createFolderForm">
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; color: #555;">Ù†Ø§Ù… Ù¾ÙˆØ´Ù‡:</label>
                <input type="text" name="name" placeholder="Ù†Ø§Ù… Ù¾ÙˆØ´Ù‡" required
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; color: #555;">ØªÙˆØ¶ÛŒØ­Ø§Øª:</label>
                <textarea name="description" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª"
                          style="width: 100%; height: 80px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; resize: vertical;"></textarea>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px; color: #555;">Ù¾ÙˆØ´Ù‡ ÙˆØ§Ù„Ø¯:</label>
                <select name="parent_folder_id" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="">Ø±ÛŒØ´Ù‡ (Ø¨Ø¯ÙˆÙ† ÙˆØ§Ù„Ø¯)</option>
                </select>
                <small style="color: #7f8c8d;">Ù¾ÛŒØ´â€ŒÙØ±Ø¶: Ù¾ÙˆØ´Ù‡ ÙØ¹Ù„ÛŒ. Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø± Ø±ÛŒØ´Ù‡ØŒ "Ø±ÛŒØ´Ù‡" Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</small>
            </div>

            <div style="display: flex; gap: 10px;">
                <button type="submit" class="btn btn-primary" style="flex: 1;">ğŸ“ Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡</button>
                <button type="button" class="btn" onclick="hideCreateFolderModal()"
                        style="flex: 1; background: #95a5a6; color: white;">âŒ Ù„ØºÙˆ</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ -->
<div id="uploadModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000;">
    <div style="background: white; width: 600px; margin: 50px auto; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3);">
        <h3 style="color: #2c3e50; margin-bottom: 20px;">Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯</h3>
        <form id="uploadForm" enctype="multipart/form-data">
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; color: #555;">Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§:</label>
                <input type="file" name="files" multiple required
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                <small style="color: #7f8c8d;">Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú†Ù†Ø¯ ÙØ§ÛŒÙ„ Ø±Ø§ Ù‡Ù…Ø²Ù…Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</small>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; color: #555;">Ø´Ø±Ø­ Ø³Ù†Ø¯:</label>
                <textarea name="description" placeholder="Ø´Ø±Ø­ Ø³Ù†Ø¯"
                          style="width: 100%; height: 80px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; resize: vertical;"></textarea>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px; color: #555;">Ù¾ÙˆØ´Ù‡ Ù…Ù‚ØµØ¯:</label>
                <select name="folder_id" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="">Ø±ÛŒØ´Ù‡ (Ø°Ø®ÛŒØ±Ù‡ Ù…Ø³ØªÙ‚ÛŒÙ…)</option>
                </select>
                <small style="color: #7f8c8d;">Ù¾ÛŒØ´â€ŒÙØ±Ø¶: Ù¾ÙˆØ´Ù‡ ÙØ¹Ù„ÛŒ. Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø±ÛŒØ´Ù‡ØŒ "Ø±ÛŒØ´Ù‡" Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</small>
            </div>

            <div style="display: flex; gap: 10px;">
                <button type="submit" class="btn btn-success" style="flex: 1;">ğŸ“¤ Ø¢Ù¾Ù„ÙˆØ¯ Ùˆ Ø§Ø³Ú©Ù†</button>
                <button type="button" class="btn" onclick="hideUploadModal()"
                        style="flex: 1; background: #95a5a6; color: white;">âŒ Ù„ØºÙˆ</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØªÙˆØ§ÛŒ Ø³Ù†Ø¯ -->
<div id="documentModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000;">
    <div style="background: white; width: 95%; max-width: 1200px; margin: 20px auto; padding: 25px; border-radius: 10px; box-shadow: 0 5px 25px rgba(0,0,0,0.3); max-height: 95vh; overflow: hidden; display: flex; flex-direction: column;">
        <!-- Ù‡Ø¯Ø± Modal -->
        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #f0f0f0;">
            <h3 id="documentTitle" style="color: #2c3e50; margin: 0; flex: 1;"></h3>
            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                <button id="showOriginalBtn" class="btn" style="background: #3498db; color: white; padding: 8px 12px; font-size: 14px;">ğŸ“„ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ</button>
                <button id="showTextBtn" class="btn" style="background: #27ae60; color: white; padding: 8px 12px; font-size: 14px;">ğŸ“ Ù…ØªÙ† Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡</button>
                <button id="zoomOutBtn" class="btn" style="background: #f39c12; color: white; padding: 8px 12px; font-size: 14px;">ğŸ” Ú©ÙˆÚ†Ú©</button>
                <button id="zoomInBtn" class="btn" style="background: #f39c12; color: white; padding: 8px 12px; font-size: 14px;">ğŸ” Ø¨Ø²Ø±Ú¯</button>
                <button id="resetZoomBtn" class="btn" style="background: #95a5a6; color: white; padding: 8px 12px; font-size: 14px;">ğŸ”„ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ</button>
                <button id="copyTextBtn" class="btn" style="background: #9b59b6; color: white; padding: 8px 12px; font-size: 14px;">ğŸ“‹ Ú©Ù¾ÛŒ Ù…ØªÙ†</button>
                <button id="downloadBtn" class="btn" style="background: #e67e22; color: white; padding: 8px 12px; font-size: 14px;">ğŸ’¾ Ø¯Ø§Ù†Ù„ÙˆØ¯</button>
                <button class="btn" onclick="hideDocumentModal()" style="background: #e74c3c; color: white; padding: 8px 12px; font-size: 14px;">âŒ Ø¨Ø³ØªÙ†</button>
            </div>
        </div>

        <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ù†Ø¯ -->
        <div id="documentInfo" style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-right: 4px solid #3498db;">
            <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ JavaScript Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
        </div>

        <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø³Ù†Ø¯ -->
        <div id="documentContent" style="flex: 1; background: #f8f9fa; border: 2px solid #e0e0e0; border-radius: 8px; padding: 20px; overflow: auto; position: relative; min-height: 400px; display: flex; align-items: flex-start; justify-content: center;">
            <!-- Ù…Ø­ØªÙˆØ§ Ø¨Ø§ JavaScript Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
        </div>

        <!-- ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø²Ø´ -->
        <div id="processingStatus" style="margin-top: 15px; padding: 10px; text-align: center; border-radius: 5px;">
            <!-- ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§ JavaScript Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
        </div>
    </div>
</div>

<style>
    .zoom-level-1 { transform: scale(1); }
    .zoom-level-2 { transform: scale(1.2); }
    .zoom-level-3 { transform: scale(1.4); }
    .zoom-level-4 { transform: scale(1.6); }
    .zoom-level-5 { transform: scale(1.8); }
    .zoom-level-6 { transform: scale(2); }
    .zoom-level-7 { transform: scale(2.2); }
    .zoom-level-8 { transform: scale(2.4); }
    .zoom-level-9 { transform: scale(2.6); }
    .zoom-level-10 { transform: scale(2.8); }

    .image-container {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        width: 100%;
        height: 100%;
        overflow: auto;
        padding: 10px;
    }

    .image-content {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        transition: transform 0.3s ease;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        background: white;
        border-radius: 5px;
    }

    .text-content {
        width: 100%;
        height: auto;
        min-height: 100%;
        white-space: pre-wrap;
        text-align: right;
        direction: rtl;
        font-family: 'Tahoma', Arial, sans-serif;
        line-height: 1.8;
        padding: 30px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }

    .pdf-download-option {
        text-align: center;
        padding: 40px;
    }

    .pdf-option-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 20px;
        flex-wrap: wrap;
    }

    .content-zoomed {
        position: fixed;
        top: 50px;
        left: 50px;
        right: 50px;
        bottom: 50px;
        z-index: 3000;
        background: white;
        border: 3px solid #3498db;
        border-radius: 10px;
        box-shadow: 0 0 50px rgba(0,0,0,0.5);
        padding: 30px;
        overflow: auto;
    }

    .active-tab {
        box-shadow: 0 0 0 2px #2c3e50;
        font-weight: bold;
    }

    .loading-spinner {
        display: inline-block;
        width: 50px;
        height: 50px;
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>

<script>
    let currentZoomLevel = 1;
    let isFullScreen = false;
    let currentView = 'original';
    let currentDocumentData = null;

    // ØªÙˆØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ùˆ Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§
    function showCreateFolderModal() {
        document.getElementById('createFolderModal').style.display = 'block';
    }

    function hideCreateFolderModal() {
        document.getElementById('createFolderModal').style.display = 'none';
    }

    function showUploadModal() {
        document.getElementById('uploadModal').style.display = 'block';
    }

    function hideUploadModal() {
        document.getElementById('uploadModal').style.display = 'none';
    }

    function hideDocumentModal() {
        document.getElementById('documentModal').style.display = 'none';
        isFullScreen = false;
        resetZoom();
        currentView = 'original';
    }

    // Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø®Ø§Ø±Ø¬ Ø§Ø² Ø¢Ù†
    document.addEventListener('DOMContentLoaded', function() {
        // Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¯Ø§Ù„ Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡
        document.getElementById('createFolderModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideCreateFolderModal();
            }
        });

        // Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¯Ø§Ù„ Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„
        document.getElementById('uploadModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideUploadModal();
            }
        });

        // Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¯Ø§Ù„ Ù†Ù…Ø§ÛŒØ´ Ø³Ù†Ø¯
        document.getElementById('documentModal').addEventListener('click', function(e) {
            if (e.target === this && !isFullScreen) {
                hideDocumentModal();
            }
        });

        // Event Listeners Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¯Ø§Ù„ Ø³Ù†Ø¯
        document.getElementById('zoomInBtn').addEventListener('click', zoomIn);
        document.getElementById('zoomOutBtn').addEventListener('click', zoomOut);
        document.getElementById('resetZoomBtn').addEventListener('click', resetZoom);
        document.getElementById('copyTextBtn').addEventListener('click', copyText);
        document.getElementById('downloadBtn').addEventListener('click', downloadFile);
        document.getElementById('showOriginalBtn').addEventListener('click', () => showOriginalFile(currentDocumentData));
        document.getElementById('showTextBtn').addEventListener('click', () => showExtractedText(currentDocumentData));

        // Ø¨Ø³ØªÙ† Modal Ø¨Ø§ Ú©Ù„ÛŒØ¯ ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (isFullScreen) {
                    toggleFullScreen();
                } else if (document.getElementById('documentModal').style.display === 'block') {
                    hideDocumentModal();
                } else if (document.getElementById('createFolderModal').style.display === 'block') {
                    hideCreateFolderModal();
                } else if (document.getElementById('uploadModal').style.display === 'block') {
                    hideUploadModal();
                }
            }
        });

        // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Ø¢Ù†
        document.querySelectorAll('.modal-content, .modal-content *').forEach(element => {
            element.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        });
    });

    // ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØªÙˆØ§ÛŒ Ø³Ù†Ø¯
    async function showDocumentContent(documentId) {
        try {
            console.log('Loading document content for ID:', documentId);
            const documentContent = document.getElementById('documentContent');

            // Ù†Ù…Ø§ÛŒØ´ Ø§Ø³Ù¾ÛŒÙ†Ø± Ø¯Ø± Ø­Ø§Ù„ Ù„ÙˆØ¯
            documentContent.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: #7f8c8d;">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 20px; font-size: 16px;">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³Ù†Ø¯...</p>
                </div>
            `;

            const response = await fetch(`/document-content/${documentId}/`);
            const data = await response.json();
            console.log('Document data received:', data);

            currentDocumentData = data;

            // ØªÙ†Ø¸ÛŒÙ… Ø¹Ù†ÙˆØ§Ù†
            document.getElementById('documentTitle').textContent = data.file_name;

            // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ù†Ø¯
            updateDocumentInfo(data);

            // Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØªÙˆØ§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ)
            showOriginalFile(data);

            // ØªÙ†Ø¸ÛŒÙ… ÙˆØ¶Ø¹ÛŒØª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            updateButtonStates(data.ocr_processed || data.processed);

            // Ù†Ù…Ø§ÛŒØ´ Modal
            document.getElementById('documentModal').style.display = 'block';

        } catch (error) {
            console.error('Error loading document content:', error);
            const documentContent = document.getElementById('documentContent');
            documentContent.innerHTML = `
                <div style="text-align: center; padding: 60px 20px; color: #e74c3c;">
                    <div style="font-size: 64px; margin-bottom: 20px;">âŒ</div>
                    <h4 style="margin-bottom: 10px;">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³Ù†Ø¯</h4>
                    <p>${error.message}</p>
                    <button class="btn" onclick="hideDocumentModal()"
                            style="background: #e74c3c; color: white; padding: 10px 20px; margin-top: 15px;">
                        Ø¨Ø³ØªÙ†
                    </button>
                </div>
            `;
        }
    }

    // Ù†Ù…Ø§ÛŒØ´ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ - Ù†Ø³Ø®Ù‡ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ PDF
    function showOriginalFile(data) {
        console.log('Showing original file:', data);
        currentView = 'original';
        const documentContent = document.getElementById('documentContent');

        // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ
        document.getElementById('showOriginalBtn').classList.add('active-tab');
        document.getElementById('showTextBtn').classList.remove('active-tab');

        const fileExtension = data.file_extension || data.file_type || data.file_name.split('.').pop().toLowerCase();

        if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'].includes(fileExtension)) {
            // Ù†Ù…Ø§ÛŒØ´ ØªØµÙˆÛŒØ± Ø¨Ø§ Ú©Ø§Ù†ØªÛŒÙ†Ø± Ù…Ù†Ø§Ø³Ø¨
            if (data.original_file_url) {
                documentContent.innerHTML = `
                    <div class="image-container">
                        <img src="${data.original_file_url}"
                             alt="${data.file_name}"
                             class="image-content zoom-level-${currentZoomLevel}"
                             ondblclick="toggleFullScreen()"
                             id="contentDisplay"
                             style="cursor: zoom-in;"
                             onload="handleImageLoad(this)"
                             onerror="handleImageError(this)">
                    </div>
                `;
            } else {
                showFileNotAvailable();
            }
        } else if (fileExtension === 'pdf') {
            // Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ PDF Ø¨Ø¯ÙˆÙ† iframe
            if (data.original_file_url) {
                showPDFOptions(data.original_file_url);
            } else {
                showFileNotAvailable();
            }
        } else {
            // ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø±
            showFileNotAvailable();
        }
    }

    // Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ PDF
    function showPDFOptions(pdfUrl) {
        const documentContent = document.getElementById('documentContent');

        documentContent.innerHTML = `
            <div class="pdf-download-option">
                <div style="font-size: 64px; margin-bottom: 20px;">ğŸ“„</div>
                <h4 style="color: #2c3e50; margin-bottom: 10px;">ÙØ§ÛŒÙ„ PDF</h4>
                <p style="color: #7f8c8d; margin-bottom: 20px;">Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙØ§ÛŒÙ„ PDF Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:</p>

                <div class="pdf-option-buttons">
                    <button onclick="downloadPDF('${pdfUrl}')"
                            class="btn"
                            style="background: #3498db; color: white; padding: 12px 20px;">
                        ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ PDF
                    </button>
                    <button onclick="viewPDFInNewTab('${pdfUrl}')"
                            class="btn"
                            style="background: #27ae60; color: white; padding: 12px 20px;">
                        ğŸ‘ï¸ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± ØªØ¨ Ø¬Ø¯ÛŒØ¯
                    </button>
                </div>

                <div style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-right: 4px solid #f39c12;">
                    <p style="margin: 0; color: #e67e22; font-size: 14px;">
                        ğŸ’¡ <strong>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ:</strong> ÙØ§ÛŒÙ„ PDF Ø¯Ø± Ù‡Ù…ÛŒÙ† Ù¾Ù†Ø¬Ø±Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.
                        Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙØ§ÛŒÙ„ØŒ Ø¢Ù† Ø±Ø§ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø¯Ø± ØªØ¨ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯.
                    </p>
                </div>
            </div>
        `;
    }

    // Ù…Ø´Ø§Ù‡Ø¯Ù‡ PDF Ø¯Ø± ØªØ¨ Ø¬Ø¯ÛŒØ¯
    function viewPDFInNewTab(pdfUrl) {
        window.open(pdfUrl, '_blank');
        showNotification('ğŸ“„ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† PDF Ø¯Ø± ØªØ¨ Ø¬Ø¯ÛŒØ¯...');
    }

    // Ø¯Ø§Ù†Ù„ÙˆØ¯ PDF
    function downloadPDF(pdfUrl) {
        const link = document.createElement('a');
        link.href = pdfUrl;
        link.download = currentDocumentData.file_name;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showNotification('âœ… Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ PDF...');
    }

    // Ù†Ù…Ø§ÛŒØ´ Ù…ØªÙ† Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡ - Ù†Ø³Ø®Ù‡ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡
    function showExtractedText(data) {
        currentView = 'text';
        const documentContent = document.getElementById('documentContent');

        // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ù…ØªÙ†
        document.getElementById('showOriginalBtn').classList.remove('active-tab');
        document.getElementById('showTextBtn').classList.add('active-tab');

        const isProcessed = data.ocr_processed || data.processed;
        const hasText = data.extracted_text && data.extracted_text.trim().length > 0;

        if (isProcessed && hasText) {
            documentContent.innerHTML = `
                <div class="text-content zoom-level-${currentZoomLevel}"
                     id="contentDisplay"
                     style="cursor: default; user-select: text;">
                    ${data.extracted_text}
                </div>
            `;
        } else {
            documentContent.innerHTML = `
                <div style="text-align: center; padding: 60px 20px; color: #e74c3c;">
                    <div style="font-size: 64px; margin-bottom: 20px;">â³</div>
                    <h4 style="margin-bottom: 10px;">Ù…ØªÙ† Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</h4>
                    <p>Ø§ÛŒÙ† Ø³Ù†Ø¯ Ù‡Ù†ÙˆØ² Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª ÛŒØ§ Ù…ØªÙ†ÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
                    <p>Ù„Ø·ÙØ§Ù‹ Ú†Ù†Ø¯ Ù„Ø­Ø¸Ù‡ ØµØ¨Ø± Ú©Ù†ÛŒØ¯ Ùˆ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.</p>
                    ${isProcessed ? '<p style="color: #7f8c8d; margin-top: 10px;">(Ø³Ù†Ø¯ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø´Ø¯Ù‡ Ø§Ù…Ø§ Ù…ØªÙ†ÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†Ø´Ø¯Ù‡)</p>' : ''}
                </div>
            `;
        }
    }

    // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø¹Ø¯Ù… Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ÙØ§ÛŒÙ„
    function showFileNotAvailable() {
        const documentContent = document.getElementById('documentContent');
        const isProcessed = currentDocumentData.ocr_processed || currentDocumentData.processed;

        documentContent.innerHTML = `
            <div style="text-align: center; color: #7f8c8d; padding: 40px;">
                <div style="font-size: 64px; margin-bottom: 20px;">ğŸ“„</div>
                <h4>ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª</h4>
                <p>ÙØ§ÛŒÙ„ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø­Ø°Ù Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ ÛŒØ§ Ø¯Ø± Ù…Ø³ÛŒØ± Ø¯ÛŒÚ¯Ø±ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯.</p>
                <p>Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ø¢Ù¾Ù„ÙˆØ¯ Ù…Ø¬Ø¯Ø¯ ÙØ§ÛŒÙ„ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø­Ø§ØµÙ„ Ú©Ù†ÛŒØ¯.</p>
                ${isProcessed ? `
                    <button class="btn" onclick="showExtractedText(currentDocumentData)"
                            style="background: #27ae60; color: white; padding: 10px 20px; margin-top: 15px;">
                        ğŸ“ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…ØªÙ† Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡
                    </button>
                ` : ''}
            </div>
        `;
    }

    // Ù…Ø¯ÛŒØ±ÛŒØª Ù„ÙˆØ¯ ØªØµÙˆÛŒØ±
    function handleImageLoad(imgElement) {
        console.log('Image loaded successfully');
        imgElement.style.maxWidth = '100%';
        imgElement.style.maxHeight = '100%';
        imgElement.style.objectFit = 'contain';
    }

    // Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ÛŒ ØªØµÙˆÛŒØ±
    function handleImageError(imgElement) {
        console.error('Image load error:', imgElement.src);
        showFileNotAvailable();
    }

    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ù†Ø¯
    function updateDocumentInfo(data) {
        const documentInfo = document.getElementById('documentInfo');
        const isProcessed = data.ocr_processed || data.processed;
        const confidence = data.confidence || data.extraction_confidence || 0;

        documentInfo.innerHTML = `
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                <div>
                    <strong>ğŸ‘¤ Ù…Ø§Ù„Ú©:</strong> ${data.person_name}
                </div>
                <div>
                    <strong>ğŸ“ Ù†ÙˆØ¹ ÙØ§ÛŒÙ„:</strong> ${(data.file_extension || data.file_type || 'Ù†Ø§Ù…Ø´Ø®Øµ').toUpperCase()}
                </div>
                <div>
                    <strong>ğŸ“… ÙˆØ¶Ø¹ÛŒØª:</strong>
                    ${isProcessed ?
                        '<span style="color: #27ae60;">âœ“ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø´Ø¯Ù‡</span>' :
                        '<span style="color: #e74c3c;">â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´</span>'
                    }
                </div>
                ${isProcessed ? `
                <div>
                    <strong>ğŸ¯ Ø¯Ù‚Øª Ø§Ø³ØªØ®Ø±Ø§Ø¬:</strong> ${confidence}%
                </div>
                ` : ''}
                ${data.description ? `
                <div style="grid-column: 1 / -1;">
                    <strong>ğŸ“ Ø´Ø±Ø­ Ø³Ù†Ø¯:</strong> ${data.description}
                </div>
                ` : ''}
            </div>
        `;
    }

    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
    function updateButtonStates(isProcessed) {
        const showTextBtn = document.getElementById('showTextBtn');
        const copyTextBtn = document.getElementById('copyTextBtn');
        const downloadBtn = document.getElementById('downloadBtn');

        if (isProcessed) {
            showTextBtn.style.display = 'block';
            copyTextBtn.style.display = 'block';
            downloadBtn.style.display = 'block';
        } else {
            showTextBtn.style.display = 'none';
            copyTextBtn.style.display = 'none';
            downloadBtn.style.display = 'block';
        }
    }

    // ØªÙˆØ§Ø¨Ø¹ Ù…Ø¯ÛŒØ±ÛŒØª Ø²ÙˆÙ… - Ù†Ø³Ø®Ù‡ Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡
    function zoomIn() {
        if (currentZoomLevel < 10) {
            currentZoomLevel++;
            updateZoom();
        }
    }

    function zoomOut() {
        if (currentZoomLevel > 1) {
            currentZoomLevel--;
            updateZoom();
        }
    }

    function resetZoom() {
        currentZoomLevel = 1;
        updateZoom();
    }

    function updateZoom() {
        const contentDisplay = document.getElementById('contentDisplay');
        if (contentDisplay) {
            if (currentView === 'original') {
                // Ø¨Ø±Ø§ÛŒ ØªØµØ§ÙˆÛŒØ±
                contentDisplay.className = `image-content zoom-level-${currentZoomLevel}`;
            } else if (currentView === 'text') {
                // Ø¨Ø±Ø§ÛŒ Ù…ØªÙ†
                contentDisplay.className = `text-content zoom-level-${currentZoomLevel}`;
            }

            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ØªÙ† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            document.getElementById('zoomInBtn').textContent = `ğŸ” Ø¨Ø²Ø±Ú¯ (${currentZoomLevel * 100}%)`;
            document.getElementById('zoomOutBtn').textContent = `ğŸ” Ú©ÙˆÚ†Ú© (${currentZoomLevel * 100}%)`;
            document.getElementById('resetZoomBtn').textContent = `ğŸ”„ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ (${currentZoomLevel * 100}%)`;
        }
    }

    // ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ ØªÙ…Ø§Ù… ØµÙØ­Ù‡
    function toggleFullScreen() {
        const contentDisplay = document.getElementById('contentDisplay');
        const documentModal = document.getElementById('documentModal');

        if (!isFullScreen) {
            contentDisplay.classList.add('content-zoomed');
            documentModal.style.zIndex = '2999';
            isFullScreen = true;
        } else {
            contentDisplay.classList.remove('content-zoomed');
            documentModal.style.zIndex = '2000';
            isFullScreen = false;
        }
    }

    // ØªØ§Ø¨Ø¹ Ú©Ù¾ÛŒ Ù…ØªÙ†
    function copyText() {
        if (currentDocumentData && currentDocumentData.extracted_text) {
            const textArea = document.createElement('textarea');
            textArea.value = currentDocumentData.extracted_text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);

            showNotification('âœ… Ù…ØªÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú©Ù¾ÛŒ Ø´Ø¯');
        } else {
            showNotification('âš ï¸ Ù…ØªÙ†ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª');
        }
    }

    // ØªØ§Ø¨Ø¹ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„
    function downloadFile() {
        if (currentDocumentData && currentDocumentData.original_file_url) {
            const link = document.createElement('a');
            link.href = currentDocumentData.original_file_url;
            link.download = currentDocumentData.file_name;
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showNotification('âœ… Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„...');
        } else {
            showNotification('âš ï¸ ÙØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª');
        }
    }

    // ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
    function showNotification(message) {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #27ae60;
            color: white;
            padding: 15px 25px;
            border-radius: 5px;
            z-index: 4000;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            font-family: Tahoma;
        `;
        notification.textContent = message;
        document.body.appendChild(notification);

        setTimeout(() => {
            document.body.removeChild(notification);
        }, 3000);
    }
</script>