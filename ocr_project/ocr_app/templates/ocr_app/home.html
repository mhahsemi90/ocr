<!-- templates/ocr_app/home.html -->
{% extends 'ocr_app/base.html' %}

{% block page_title %}OCR ساده - استخراج متن{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">استخراج متن ساده</h2>

    <div class="upload-area"
         onclick="document.getElementById('fileInput').click()"
         style="border: 2px dashed #3498db; border-radius: 10px; padding: 40px; text-align: center; margin-bottom: 20px; cursor: pointer; transition: all 0.3s;"
         onmouseover="this.style.background='#ecf0f1'"
         onmouseout="this.style.background='white'">
        <p style="font-size: 18px; margin-bottom: 10px;">📁 برای آپلود فایل کلیک کنید</p>
        <p style="color: #7f8c8d;">پشتیبانی از: تصاویر (JPG, PNG) و PDF</p>
    </div>

    <input type="file" id="fileInput" class="file-input" accept=".jpg,.jpeg,.png,.pdf" style="display: none;">

    <div style="text-align: center;">
        <button class="btn btn-primary" onclick="processFile()">
            🔍 استخراج متن
        </button>
    </div>

    <div class="loading" id="loading" style="display: none; text-align: center; color: #3498db; margin: 20px 0;">
        <p>در حال پردازش... لطفا منتظر بمانید</p>
    </div>

    <div class="result-area" id="resultArea" style="margin-top: 30px; display: none;">
        <h3 style="color: #2c3e50; margin-bottom: 15px;">متن استخراج شده:</h3>
        <div class="text-result" id="textResult"
             style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 15px; min-height: 200px; max-height: 400px; overflow-y: auto; white-space: pre-wrap; text-align: right; direction: rtl; line-height: 1.8;">
        </div>
        <div style="text-align: center; margin-top: 15px;">
            <button class="btn btn-success" onclick="copyText()">
                📋 کپی متن
            </button>
            <button class="btn" onclick="clearResults()" style="background: #95a5a6; color: white;">
                🗑️ پاک کردن
            </button>
        </div>
    </div>
</div>

<script>
    function processFile() {
        const fileInput = document.getElementById('fileInput');
        const file = fileInput.files[0];

        if (!file) {
            alert('لطفا یک فایل انتخاب کنید');
            return;
        }

        const formData = new FormData();
        formData.append('file', file);

        const loading = document.getElementById('loading');
        const resultArea = document.getElementById('resultArea');
        const textResult = document.getElementById('textResult');

        loading.style.display = 'block';
        resultArea.style.display = 'none';

        fetch('/extract-text/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            }
        })
        .then(response => response.json())
        .then(data => {
            loading.style.display = 'none';

            if (data.status === 'success') {
                textResult.textContent = data.text || 'متنی یافت نشد';
                resultArea.style.display = 'block';

                // اسکرول به نتایج
                resultArea.scrollIntoView({ behavior: 'smooth' });
            } else {
                alert('خطا: ' + data.error);
            }
        })
        .catch(error => {
            loading.style.display = 'none';
            alert('خطا در ارتباط با سرور');
            console.error('Error:', error);
        });
    }

    function copyText() {
        const textResult = document.getElementById('textResult');
        const textArea = document.createElement('textarea');
        textArea.value = textResult.textContent;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('متن با موفقیت کپی شد');
    }

    function clearResults() {
        document.getElementById('textResult').textContent = '';
        document.getElementById('resultArea').style.display = 'none';
        document.getElementById('fileInput').value = '';
        document.querySelector('.upload-area p').textContent = '📁 برای آپلود فایل کلیک کنید';
    }

    // نمایش نام فایل انتخاب شده
    document.getElementById('fileInput').addEventListener('change', function(e) {
        const fileName = e.target.files[0]?.name;
        const uploadArea = document.querySelector('.upload-area p');
        if (fileName) {
            uploadArea.innerHTML = `✅ فایل انتخاب شده: <strong>${fileName}</strong>`;
        }
    });
</script>
{% endblock %}